---
title: "Automatiza la publicaciÃ³n de tus reportes"
subtitle: "con Quarto y GitHub Actions"
format: clean-revealjs
embed-resources: true
html-math-method:
  method: mathjax
  url: "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
author:
  - name: Jesica Formoso
    email: jesica.formoso@gmail.com
    affiliations: CIIPME-CONICET | MetaDocencia ğŸ
  - name: MarÃ­a Cristina Nanton
    email: mcnanton@gmail.com
    affiliations: GCBA | TGHN | UBA
editor: 
  markdown: 
    wrap: 72
---

## Â¡Hola!ğŸ‘‹

::::::: columns
:::: {.column width="50%"}
::: {style="text-align:center;"}
<img src="imagenes/Mari-perfil.jpg" style="border-radius:1em; width:200px; height:200px; object-fit:cover;"/>

<p style="font-size:0.4em; margin-top:0.5em;">

<strong>MarÃ­a Cristina Nanton</strong><br> CoordinaciÃ³n en Ciencia de
Datos en Gerencia de InformaciÃ³n y EstadÃ­sticas en Salud (GCBA)<br><br>
AI Dev en The Global Health Network <br><br> R-Ladies Buenos
AiresğŸ’œ<br><br> Colaboradora<br> en MetaDocenciağŸ

</p>
:::
::::

:::: {.column width="50%"}
::: {style="text-align:center;"}
<img src="imagenes/jesi-perfil.jpg" style="border-radius:1em; width:200px; height:200px; object-fit:cover;"/>

<p style="font-size:0.4em; margin-top:0.5em;">

<strong>Jesica Formoso</strong><br> Investigadora Adjunta,<br>
CIIPME-CONICET
<img src="imagenes/conicet.jpg" alt="Logo CONICET" style="height:1.2em; vertical-align:middle; margin-left:0.3em;"/>
<br><br> MediciÃ³n de Impacto en MetadocenciağŸ<br><br> R-Ladies Buenos Aires ğŸ’œ

</p>
:::
::::
:::::::

## QuÃ© vamos a ver hoy

### Agenda

-   Conceptos bÃ¡sicos para trabajar con GitHub Actions, GH Pages y
    Quarto

-   PreparaciÃ³n de un entorno de trabajo para flujos *bien*
    automatizados

-   CreaciÃ³n de un flujo automatizado de publicaciÃ³n en GH Pages basado
    en pushes a un repositorio

-   AdaptaciÃ³n a ejecuciones periÃ³dicas

## QuÃ© vamos a implementar hoy

Un sitio publicado en GH Pages generado desde Quarto alimentado de
manera periÃ³dica y automatizada a partir de respuestas a un formulario
con orquestaciÃ³n via GH Actions

![](imagenes/flujo1.jpg){fig-align="center"}

# CI/CD y GitHub Actions

**Conceptos bÃ¡sicos**

## GitHub y GitHub Actions

::::: columns
::: {.column width="50%"}
![](imagenes/GitHub_Logo.png){fig-align="center" width="488"}

**GitHub**

Plataforma orientada al desarrollo de software que integra repositorios
con control de versiones con un enfoque de desarrollo colaborativo
:::

::: {.column width="50%"}
![](imagenes/GitHub_actions_Logo.png){fig-align="center"}

**GitHub Actions**

Herramienta de integraciÃ³n y deploy continuo (CI/CD) que permite
automatizar el trabajo con cÃ³digo, desde los testeos hasta la
publicaciÃ³n de productos
:::
:::::

## Â¿CI/CD?

> La integraciÃ³n continua (CI) consiste en integrar los cambios del
> cÃ³digo en un repositorio de cÃ³digo fuente compartido de forma
> automÃ¡tica y frecuente.La implementaciÃ³n o distribuciÃ³n continua (CD)
> es un proceso de dos partes que implica la integraciÃ³n, la prueba y la
> distribuciÃ³n de los cambios en el cÃ³digo.

![](imagenes/cdcd_redhat.png){fig-align="center"}

*Fuente: Red Hat*

## Ejemplos no tan *lejanos*

**rOpenSci** usa CI/CD con GHA para actualizar su GuÃ­a de desarrollo!

::::: columns
::: {.column width="50%"}
![](imagenes/ros1.png){fig-align="center" width="488"}
![](imagenes/ros4.png){fig-align="center"}
:::

::: {.column width="50%"}
![](imagenes/ros2.png){fig-align="center"}

![](imagenes/ros3.png){fig-align="center"}
:::
:::::

## Ejemplos no tan *lejanos*

**Turing Way** usa CI/CD con GHA para flujos de chequeo y publicaciÃ³n:
por ejemplo, para revisar el mal uso del latin en sus publicaciones!

::::: columns
::: {.column width="50%"}
![](imagenes/tw4.png){fig-align="center" width="488"}
![](imagenes/tw3.png){fig-align="center"}
:::

::: {.column width="50%"}
![](imagenes/tw1.png){fig-align="center" width="347"}

![](imagenes/tw2.png){fig-align="center"}
:::
:::::

## Â¿Notaron el uso de YAML?

Las GHA usan sintaxis YAML para organizar las automatizaciones.

:::::: columns
::: {.column width="40%"}
![](imagenes/yaml1.png){fig-align="center"}
:::

:::: {.column width="60%"}
::: {style="display:flex; justify-content:center; gap:20px; align-items:center;"}
<img src="imagenes/yaml4.png" width="165"/>
<img src="imagenes/yaml2.png" width="150"/>
:::

![](imagenes/yaml3.png){fig-align="center" width="265"}
::::
::::::

## Â¿QuÃ© vamos a incluir en este YAML?

Â¡Todo lo que un proyecto de Quarto con R necesita para ejecutarse de
manera automÃ¡tica!

::: incremental
-   Quarto, por supuesto
-   R para procesar nuestros datos
-   Un repositorio donde este alojado nuestro archivo Qmd
:::

## Â¿QuÃ© vamos a incluir en este YAML?

Â¡Todo lo que un proyecto de Quarto con R necesita para ejecutarse de
manera automÃ¡tica!

-   Quarto, por supuesto
-   R para procesar nuestros datos
-   Un repositorio donde este alojado nuestro archivo Qmd

Y ademÃ¡s:

::: incremental
-   Instrucciones sobre cuÃ¡ndo correr las automatizaciones...
-   ... y una mÃ¡quina virtual que las ejecute...
-   ... que pueda acceder a las dependencias necesarias e instalarlas!
:::

## De nuestra PC a GHA

![](imagenes/flujo2.jpg){fig-align="center"}

## InstalaciÃ³n de dependencias

### Biblioteca `renv`

::::: columns
::: {.column width="50%"}
![](imagenes/renv_log.png){fig-align="center"}
:::

::: {.column width="50%"}
Herramienta que permite **capturar** todas las bibliotecas que usadas en
un proyecto e **instalarlas** si es necesario

SÃ­mil `venv` si vienen de manejar Python
:::
:::::

## Â¿DÃ³nde *corre* todo esto en una ejecuciÃ³n automatizada?

::::: columns
::: {.column width="50%"}
Una mÃ¡quina virtual (VM) es una manera de emular un equipo fÃ­sico (como
nuestras computadoras) en todos sus aspectos: espacio de almacenamiento,
memoria y **sistema operativo**.

Son entornos aislados que podemos utilizar para ejecutar procesos.
:::

::: {.column width="50%"}
![](imagenes/runner_imagenes.png){fig-align="center"}
:::
:::::

## DÃ¡ndole ritmo a la automatizaciÃ³n

### ProgramaciÃ³n de tareas con crontab

En sistemas operativos Unix, **cron** es un administrador de procesos
para ejecutarlos a intervalos regulares

### Expresiones CRON

```         
* * * * *   comando-a-ejecutar
| | | | |
| | | | â””â”€â”€ DÃ­a de la semana (0-7, donde 0 y 7 representan domingo)
| | | â””â”€â”€â”€â”€ Mes (1-12)
| | â””â”€â”€â”€â”€â”€â”€ DÃ­a del mes (1-31)
| â””â”€â”€â”€â”€â”€â”€â”€â”€ Hora (0-23)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minuto (0-59)
```

## CRON

Con estas expresiones podemos ordenar la ejecuciÃ³n de procesos con
cualquier periodicidad

```         
0 * * * *   revisar_cada_una_hora
| | | | |
| | | | â””â”€â”€ DÃ­a de la semana (todos)
| | | â””â”€â”€â”€â”€ Mes (todos)
| | â””â”€â”€â”€â”€â”€â”€ DÃ­a del mes (todos)
| â””â”€â”€â”€â”€â”€â”€â”€â”€ Hora (todos)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ Minuto (al minuto 0, es decir, el inicio de cada hora)
```

## Del cÃ³digo al HTML

::::: columns
::: {.column width="50%"}
![](imagenes/logo_quarto.png){fig-align="center" width="173"}

**Quarto**

Herramienta para generar artÃ­culos, sitios o publicaciones en formatos
word, pdf, html, entre otros
:::

::: {.column width="50%"}
![](imagenes/gh_pages_logo.png){fig-align="center" width="200"}

**Github Pages**

Herramienta de GitHub para crear sitios web directamente desde el
contenido de un repositorio
:::
:::::

## Ahora sÃ­: la infraestructura de nuestra automatizaciÃ³n

![](imagenes/flujo3.jpg){fig-align="center"}

# Mini-evaluaciÃ³n 1

Vamos a usar las reacciones de zoom para preguntas de opciÃ³n mÃºltiple

![](imagenes/reacciones.png){fig-align="center" width="179"}

## Mini-evaluaciÃ³n 1:

### Â¿QuÃ© herramiena permite controlar los paquetes necesarios para reproducir el proyecto en GitHub Actions?

ğŸ‘ Quarto

ğŸ˜® renv

ğŸ‘ GitHub

## Mini-evaluaciÃ³n 1:

### Â¿QuÃ© formato utilizan los archivos de configuraciÃ³n de las GitHub Actions?

ğŸ‘ YAML

ğŸ˜® .workflow

ğŸ‘ cron

## Mini-evaluaciÃ³n 1:

### Â¿CuÃ¡l es el sistema operativo de la mÃ¡quina que ejecutarÃ¡ las Github Actions?

ğŸ‘ El de la computadora en la que se redactÃ³ el cÃ³digo

ğŸ˜® El que elija GitHub para mi acciÃ³n

ğŸ‘ El de la mÃ¡quina virtual que configure yo

# Break (5 minutos)

# Preparando nuestro entorno

**Recorrido por los elementos del proyecto en el repositorio**

# Break (5 minutos)

## Pasos previos a generar la GitHub Action

::: incremental
-   Creamos el form y la hoja de cÃ¡lculo con acceso a cualquiera vÃ­a
    link
-   Creamos un proyecto de Quarto (website)
    -   inicializamos git
    -   inicializamos renv
-   Creamos el repositorio remoto en GitHub
-   Armamos el reporte o dashboard en el archivo **index.qmd**
    -   renv::snapshot()
-   Conectamos el repositorio local y el remoto desde la terminal de R
-   Actualizamos los cambios (commit y push)
:::

# Workflow de Github Actions

**Combinamos los elementos para un flujo automatizado**

## 

![](imagenes/gha-workflow.jpg)

## 

![](imagenes/gha-yml1.jpg)

## 

![](imagenes/gha-yml2.jpg)

## 

![](imagenes/gha-yml3.jpg)

## 

![](imagenes/gha-yml4.jpg)

## 

:::::: {.columns style="display: flex !important; align-items: center; height: 90%;"}
::: {.column width="40%"}
![](imagenes/gha-yml5.jpg)
:::

:::: {.column width="50%" style="font-size: 0.8em;"}
::: {style="display: flex; flex-direction: column; justify-content: center; height: 100%; font-size: 0.9em;"}
-   **build-deploy** es el identificador del **job**
-   **runs-on** indica el tipo de mÃ¡quina (runner) donde se ejecutarÃ¡ el
    **job**
:::
::::
::::::

## 

::::: {.columns style="display: flex !important; align-items: center; height: 90%;"}
::: {.column width="40%"}
![](imagenes/gha-yml5.jpg)
:::

::: {.column width="50%" style="font-size: 0.8em;"}
-   **permissions** configura quÃ© puede hacer el **job** sobre el
    contenido del repositorio:
    -   **write:** permiso de escritura (crear archivos, releases,
        actualizar archivos)
    -   **read:** permiso de lectura (no puede modificar el repositorio)
    -   Se puede especificar de forma global o a nivel de cada **job**
:::
:::::

## Tipos de steps (pasos)

::::: columns
::: {.column width="60%"}
![](imagenes/steps.jpg)
:::

::: {.column width="30%"}
**uses** utiliza una acciÃ³n ya existente, empaquetada por GitHub o la
comunidad
:::
:::::

## Tipos de steps (pasos)

::::: columns
::: {.column width="60%"}
![](imagenes/steps.jpg)
:::

::: {.column width="30%"}
**run** ejecuta comandos directamente en la terminal del runner
:::
:::::

## Tipos de steps (pasos)

::::: columns
::: {.column width="60%"}
![](imagenes/run1.jpg)
:::

::: {.column width="40%"}
-   Se puede ejecutar cÃ³digo en la terminal (shell) de la maquina
    virtual (para ubuntu, es bash)
:::
:::::

## Tipos de steps (pasos)

::::: columns
::: {.column width="60%"}
![](imagenes/run2.jpg)
:::

::: {.column width="40%"}
-   Se puede ejecutar cÃ³digo indicando una terminal particular, en este
    caso la de R.
:::
:::::

## Tipos de steps (pasos)

Este paso usa una acciÃ³n pre empaquetada para publicar un proyecto de
Quarto.

::::: columns
::: {.column width="40%"}
![](imagenes/steps1.jpg)
:::

::: {.column width="50%"}
**with:**

-   Los argumentos que la acciÃ³n necesita para funcionar.
-   **target:** gh-pages/netlify/connect
:::
:::::

## Tipos de steps (pasos)

Este paso usa una acciÃ³n pre empaquetada para publicar un proyecto de
Quarto.

::::: columns
::: {.column width="40%"}
![](imagenes/steps2.jpg)
:::

::: {.column width="50%"}
**env:**

-   Variables de entorno.
-   GITHUB_TOKEN
:::
:::::

## GITHUB_TOKEN

**Token de autorizaciÃ³n** que GitHub genera automÃ¡ticamente para cada
ejecuciÃ³n de un workflow de GitHub Actions.

::::: columns
::: {.column width="40%"}
![](imagenes/steps2.jpg)
:::

::: {.column width="60%"}
-   Identifica al workflow y le permite interactuar con GitHub
-   Solo existe mientras dura la ejecuciÃ³n
-   Tiene permisos controlables
:::
:::::

## Secretos del repositorio

::::: columns
::: {.column width="50%"}
![](imagenes/steps2.jpg)
:::

::: {.column width="50%\""}
-   **secrets** hace referencia a un espacio seguro donde GitHub guarda
    valores sensibles (claves, tokens, constraseÃ±as) encriptados.
:::
:::::

## Secretos del repositorio

::::: columns
::: {.column width="50%"}
![](imagenes/steps2.jpg)
:::

::: {.column width="50%\""}
-   **GITHUB_TOKEN** es el nombre de uno de esos valores.
:::
:::::


##

![](imagenes/gha-yml4.jpg)


## Tipos de eventos que disparan un workflow (Triggers)

![](imagenes/triggers.jpg)

# ActualizaciÃ³n automÃ¡tica y publicaciÃ³n en GitHub Pages

**Trabajamos en el repositorio**

## Repaso de la prÃ¡ctica

::: incremental
-   Creamos un fork del repositorio censo-meriendas
-   Creamos el archivo .github/workflows/\_publish.yml
-   Creamos la rama "gh-pages" y revisamos el setup en settings/pages
-   Modificamos los triggers para:
    -   Actualizar tras cada push
    -   Actualizar periÃ³dicamente
-   Revisamos el log de un workflow
:::

# Mini-evaluaciÃ³n 2

## Mini-evaluaciÃ³n 2:

### En quÃ© parte del YAML se indica cuÃ¡les serÃ¡n los disparadores del workflow?

ğŸ‘ jobs:

ğŸ˜® steps:

ğŸ‘ on:

## Mini-evaluaciÃ³n 2:

### Â¿De quÃ© manera se puede ejecutar cÃ³digo de R dentro de una GHA?

ğŸ‘ Dentro de un R script (ejemplo.R) via terminal de la VM

ğŸ˜® Dentro de un R script (ejemplo.R) via terminal de R

ğŸ‰ Como un comando R aislado via `Rscript -e` (install.packages())

ğŸ‘ Todas las opciones son correctas

# Buenas prÃ¡cticas

## Buenas prÃ¡cticas

::: incremental
-   Separar el â€œbuildâ€, las pruebas (â€œtestâ€) y el â€œdeployâ€ en jobs
    independientes.
-   Paralelizar jobs cuando sea posible.
-   Reutilizar acciones de terceros (third-party actions)
-   Instalar versiones especÃ­ficas de las herramientas
-   Aplicar el principio de menor privilegio.
-   **Gestionar claves de API y contraseÃ±as como variables de entorno
    usando GitHub Secrets.**
:::

## Secretos del repositorio

::::: columns
::: {.column width="50%"}
![](imagenes/var_ent3.jpg)
:::

::: {.column width="50%\""}
-   Permiten acceder a credenciales o informaciÃ³n sensible sin
    escribirlo directamente en el cÃ³digo.

-   Todo lo que almacenamos aquÃ­ queda cifrado y nunca se muestra en
    texto plano.
:::
:::::

## Secretos del repositorio

![](imagenes/var_ent4.jpg)

-   Cada secreto tiene un **nombre** y un **valor oculto**.

-   Usamos el nombre para invocar el valor desde GitHub Actions.

## Secretos del repositorio

![](imagenes/var_ent2.jpg)

Con **env** creamos variables de entorno dentro del **job**, cuyo valor
proviene de los secretos del repositorio.

## Secretos del repositorio

::::: columns
::: {.column width="60%"}
![](imagenes/var_ent1.jpg)
:::

::: {.column width="40%\""}
En **R**, las variables de entorno se leen con **Sys.getenv()**.
:::
:::::

## Temas cubiertos por el taller

![](imagenes/flujo3.jpg){fig-align="center"}

# **Â¡Muchas gracias por compartir este taller con nosotras!**

Por favor, dejanos una pequeÃ±a reseÃ±a aquÃ­ ğŸ‘‰
[**http://tiny.cc/quarto-GHA**](http://tiny.cc/quarto-GHA)

# Preguntas?

Contactanos! **jesica.formoso\@gmail.com**\| **mcnanton\@gmail.com**
